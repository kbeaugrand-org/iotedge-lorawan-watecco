name: 'Build Module'
description: 'Build Docker module in different archs'

inputs:
  image_name: 
    description: The module's image name
    required: true
  tag_name: 
    description: The module's tag name
    required: true
  module_path: 
    description: The module's source path
    required: true

runs:
  using: "composite"
  strategy:
    matrix:
      arch:  [amd64, arm32v7, arm64v8]
  steps:
  - name: Build and push amd64
    # You may pin to the exact commit or the version.
    uses: docker/build-push-action@v2.7.0
    with:
      # Build's context is the set of files located in the specified PATH or URL
      context: ${{ inputs.MODULE_PATH }}
      # Path to the Dockerfile
      file: "${{ inputs.MODULE_PATH }}/Dockerfile.amd64"
      # Push is a shorthand for --output=type=registry
      push: false
      # List of SSH agent socket or keys to expose to the build
      ssh: # optional
      # List of tags
      tags: ${{ inputs.IMAGE_NAME }}:${{ inputs.TAG_NAME }}-${{ matrix.arch }}